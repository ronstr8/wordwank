# Global settings shared across all microservices
global:
  domain: wordwank.fazigu.org
  # The single port for all traffic (Frontend, API, WS)
  externalPort: 80
  registry: localhost:5000
  namespace: wordwank
  imageTag: latest
  imagePullPolicy: Always
  maxPlayers: 13
  randomLetterScoreMode: "true"
  gameDuration: 30
  rackSize: 8
  minVowels: 2
  minConsonants: 2
  logLevel: debug
  defaultLanguage: en
  chatHistorySize: 50
  totalTiles: 100

# Persistent storage configuration
persistence:
  enabled: true
  hostBasePath: /home/user/.local/share/k8s-volumes # Overridden by Makefile with $HOME
  size: 10Gi

# Centralized Ingress configuration
ingress:
  enabled: true
  host: wordwank.fazigu.org
  annotations:
    kubernetes.io/ingress.class: nginx
    # Cert-manager will automatically provision SSL certificate
    cert-manager.io/cluster-issuer: letsencrypt-prod
    # Redirect HTTP to HTTPS
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
  tls:
    enabled: true
    secretName: wordwank-tls

# Subchart overrides
frontend:
  enabled: true
  service:
    type: ClusterIP
    port: 80

wordd:
  enabled: true
  service:
    type: ClusterIP
    port: 2345
  langs: "en,es,fr,de,ru"

backend:
  enabled: true
  image:
    tag: "latest"
  service:
    port: 3000
  database:
    url: "dbi:Pg:dbname=wordwank;host=postgresql"
    user: "wordwank_backend"
  env:
    ADMIN_SMS_EMAIL: "17169032417@tmomail.net"
    CHAT_HISTORY_SIZE: 50

# PostgreSQL dependency configuration
postgresql:
  enabled: true
  fullnameOverride: postgresql
  image:
    tag: "latest"
  auth:
    database: "wordwank"
    username: "wordwank_backend"
  primary:
    containerSecurityContext:
      enabled: true
      runAsUser: 1001
      runAsNonRoot: true
    podSecurityContext:
      fsGroup: 1001 # Match PostgreSQL user for proper volume permissions
    initContainers:
      - name: fix-permissions
        image: busybox:latest
        command:
          [
            "sh",
            "-c",
            "chmod -R 777 /bitnami/postgresql && chown -R 1001:1001 /bitnami/postgresql",
          ]
        volumeMounts:
          - name: data
            mountPath: /bitnami/postgresql
        securityContext:
          runAsUser: 0 # Run as root to change ownership
    initdb:
      scriptsConfigMap: db-init
    persistence:
      enabled: true
      storageClass: postgresql-local
      size: 10Gi
